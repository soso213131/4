

def format_price(price):
    """
    Приймає число (ціна) і повертає рядок у форматі 'ціна: xxx.xx грн'
    """
    try:
        # Приводимо до float і форматумо 2 знаки після коми
        p = float(price)
    except (ValueError, TypeError):
        raise ValueError("Неприпустимий формат ціни.")
    return f"ціна: {p:.2f} грн"


def get_availability(*items, inventory):
    """
    Приймає довільну кількість товарів (імена як рядки)
    та словник inventory (товар -> True/False).
    Повертає словник тільки з переданих товарів: {товар: True/False}
    """
    result = {}
    for it in items:
        # Обрізаємо зайві пробіли та нормалізуємо
        key = it.strip()
        if key == "":
            continue
        result[key] = bool(inventory.get(key, False))
    return result


def process_order(order_items, inventory, prices):
    """
    order_items: список рядків (імена товарів)
    inventory: словник товар -> True/False
    prices: словник товар -> число (ціна)

    Повертає кортеж:
     - (True, total_price, detail_list) якщо всі товари доступні
     - (False, missing_list) якщо є відсутні
    """
    normalized = [it.strip() for it in order_items if it.strip() != ""]
    missing = []
    total = 0.0
    details = []  # список (товар, ціна)

    for item in normalized:
        available = inventory.get(item, False)
        price_exists = item in prices
        if not available or not price_exists:
            missing.append(item)
        else:
            price = float(prices[item])
            total += price
            details.append((item, price))

    if missing:
        return False, missing
    return True, total, details


def user_interface(inventory, prices):
    """
    Консольний інтерфейс:
    Користувач обирає опцію 'купити' або 'переглянути ціну',
    вводить список товарів (через кому).
    """
    print("Лабораторна 4 — Магазин (опції: 'купити' або 'переглянути')")
    while True:
        option = input("Введіть опцію (купити / переглянути / вийти): ").strip().lower()
        if option == "вийти" or option == "exit" or option == "stop":
            print("Вихід. Дякую!")
            break
        if option not in ("купити", "переглянути"):
            print("Невідома опція. Введіть 'купити', 'переглянути' або 'вийти'.")
            continue

        raw = input("Введіть список товарів через кому (наприклад: яблуко, хліб, молоко): ")
        # Розділимо та приберемо зайві пробіли
        items = [s.strip() for s in raw.split(",") if s.strip() != ""]
        if not items:
            print("Немає товарів у замовленні — спробуйте знову.")
            continue

        # Отримаємо наявність
        availability = get_availability(*items, inventory=inventory)
        print("\nНаявність товарів:")
        for k, v in availability.items():
            print(f"  {k}: {'так' if v else 'ні'}")

        # Перевіримо замовлення
        ok = process_order(items, inventory, prices)
        if not ok[0]:
            # ok у форматі (False, missing_list)
            missing = ok[1]
            print("\nЗамовлення неможливе. Відсутні товари:")
            for m in missing:
                print(f"  - {m}")
            print("Спробуйте змінити замовлення чи перевірити наявність.\n")
            continue

        # ok у форматі (True, total, details)
        _, total, details = ok
        if option == "переглянути":
            print("\nІнформація про ціну замовлення:")
            for item, price in details:
                print(f"  {item}: {format_price(price)}")
            print(f"\nЗагальна сума: {format_price(total)}\n")
        else:  # купити
            # Підтвердження покупки
            print("\nУсі товари наявні. Підсумок замовлення:")
            for item, price in details:
                print(f"  {item}: {format_price(price)}")
            print(f"\nЗагальна сума до оплати: {format_price(total)}")
            confirm = input("Підтвердити покупку? (так/ні): ").strip().lower()
            if confirm in ("так", "y", "yes"):
                print("Дякуємо за покупку! Замовлення оформлено.\n")
                # При бажанні можна зменшити наявність у inventory (наприклад зробити False)
                for item, _ in details:
                    # Припустимо, що після покупки товар зникає:
                    inventory[item] = False
            else:
                print("Покупка скасована.\n")


# ------------------------
# Приклад початкових даних магазину
# ------------------------
if __name__ == "__main__":
    # Словник наявності товарів
    inventory_example = {
        "яблуко": True,
        "банан": True,
        "молоко": True,
        "хліб": True,
        "цукор": False,   # тимчасово немає
        "масло": True,
        "сир": True,
    }

    # Словник цін (товар -> ціна у гривнях)
    prices_example = {
        "яблуко": 5.5,
        "банан": 6.0,
        "молоко": 28.99,
        "хліб": 18.0,
        "масло": 75.5,
        "сир": 120.0,
        # "цукор" не має ціни або відсутній — покаже як недоступний
    }

    # Запуск інтерфейсу для користувача
    user_interface(inventory_example, prices_example)
